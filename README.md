# React增强型智能Agent项目介绍

## 1. 项目概述

React增强型智能Agent是一个基于LLM（大语言模型）的智能代理系统，采用React（思考-行动-观察-响应）模式实现，具备**记忆管理**、**执行规划**、**工具使用**等核心功能。该系统能够理解用户需求，制定执行计划，调用相应工具，并基于执行结果提供准确回答。

### 核心特性：
- 🧠 **记忆增强**：支持短期记忆和长期记忆管理，智能存储和检索重要信息
- 📋 **执行规划**：能够为复杂任务制定多步骤执行计划
- 🔧 **工具集成**：支持多种工具的注册和调用，如数学计算、搜索、翻译等
- 🔄 **React模式**：采用思考→规划→行动→观察→响应的完整流程
- 🛡️ **错误处理**：完善的异常处理机制，确保系统稳定性

## 2. 系统架构

系统采用模块化设计，各组件职责清晰，交互流畅。整体架构如下：

```
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│                 │      │                 │      │                 │
│   main.py       │──────▶   agent.py      │──────▶   prompt.py     │
│  程序入口与交互  │      │  ReactAgent核心 │      │ 提示词生成模块   │
│                 │      │                 │      │                 │
└────────┬────────┘      └────────┬────────┘      └─────────────────┘
         │                        │
         │                        ▼
         │                  ┌─────────────────┐
         │                  │                 │
         │                  │   tools.py      │
         │                  │ 工具基类定义     │
         │                  │                 │
         │                  └────────┬────────┘
         │                           │
         └───────────────────┬───────┘
                             │
                             ▼
                     ┌─────────────────┐
                     │                 │
                     │  tool_add.py    │
                     │ 具体工具实现     │
                     │                 │
                     └─────────────────┘
```

### 数据流：
1. **用户输入** → main.py接收并传递给agent.py
2. **处理流程**：
   - ReactAgent解析用户输入
   - 生成执行计划
   - 按步骤执行（调用工具或直接回答）
   - 更新记忆
   - 返回结果
3. **工具调用**：通过tools.py定义的接口调用tool_add.py中实现的具体工具
4. **提示词生成**：通过prompt.py生成各类任务所需的提示词模板

## 3. 文件功能介绍

### 3.1 main.py

**功能**：程序主入口，负责初始化环境、注册工具、创建Agent实例，并处理用户交互。

**主要职责**：
- 初始化LLM客户端连接（Ollama）
- 注册各类工具（数学运算、搜索等）
- 创建ReactAgent实例
- 处理用户交互（特殊命令支持）
  - `status`：查看Agent状态
  - `memory`：查看问题记忆摘要
  - `history`：查看工具执行历史记录
  - `clear`：清除记忆

**关键代码结构**：
```python
# 初始化LLM客户端
llm = OllamaLLM(...)

# 创建工具注册器并注册工具
tool = ToolRegister()
tool.register_tool("add", "执行加法运算：a + b", add)
# ...其他工具注册

# 创建ReactAgent实例
agent = ReactAgent(llm, tool.get_tools())

# 交互模式处理
while True:
    user_input = input("请输入您的请求: ")
    # 处理特殊命令和用户查询
```

### 3.2 agent.py

**功能**：ReactAgent的核心实现，包含所有核心功能模块。

**主要组件**：
- **记忆管理**：短期记忆和长期记忆的存储与检索
- **规划系统**：为用户请求生成多步骤执行计划
- **工具调用**：解析用户输入，选择并执行合适的工具
- **响应生成**：根据执行结果生成最终回答

**关键方法**：
- `process_query()`：处理用户查询的主方法，实现React模式
- `create_plan()`：生成执行计划
- `parse_user_input()`：解析用户输入，提取工具和参数
- `execute_tool()`：执行指定工具
- `update_memory()`：更新Agent记忆
- `get_memory_summary()`：获取记忆摘要
- `get_execution_history()`：获取执行历史

**多步骤执行流程**：
```python
def process_query(self, user_input: str) -> str:
    # 1. 创建执行计划
    plan = self.create_plan(user_input)
    
    # 2. 按步骤执行
    for step in plan:
        # 根据步骤类型执行操作
        if action == "使用工具":
            # 执行工具并存储结果
        elif action == "直接回答":
            # 生成总结回答
    
    # 3. 更新记忆
    self.update_memory(user_input, final_response)
    
    return final_response
```

### 3.3 prompt.py

**功能**：提供各类任务的提示词模板生成功能。

**主要函数**：
- `create_prompt()`：生成工具选择和参数提取的提示词
- `create_planning_prompt()`：生成执行计划提示词
- `create_memory_prompt()`：生成记忆处理提示词

**提示词结构**：
- 任务说明
- 工具信息描述
- 历史对话上下文
- 输出格式要求

### 3.4 tools.py

**功能**：定义工具的基类和接口规范。

**核心类**：
- `Tool`：工具基类，定义了工具的基本结构和执行逻辑
  - `__init__()`：初始化工具
  - `get_schema()`：获取工具的JSON schema描述
  - `execute()`：执行工具功能
  - `get_parameter_info()`：从函数签名提取参数信息

**工具定义规范**：
- 工具名称
- 功能描述
- 参数定义（名称、类型、是否必需）
- 执行函数

### 3.5 tool_add.py

**功能**：实现各类具体工具的逻辑。

**主要组件**：
- `ToolRegister`：工具注册器类，负责管理和注册各种工具
- 具体工具实现函数：
  - 数学计算工具：add、subtract、multiply、divide、calculate_power
  - 搜索工具：search（支持HANA数据库搜索）
  - 翻译工具：translate
  - 天气查询工具：weather

**工具注册流程**：
```python
def register_tool(self, name, description, function):
    # 创建Tool实例并添加到工具字典
    self.tools[name] = Tool(name, description, function)
```

## 4. 核心功能详解

### 4.1 React模式实现

系统严格遵循React（思考-行动-观察-响应）模式：
1. **思考**：解析用户输入，理解需求
2. **规划**：生成多步骤执行计划
3. **行动**：按计划执行工具调用
4. **观察**：收集工具执行结果
5. **响应**：基于结果生成最终回答

### 4.2 记忆管理系统

**短期记忆**：
- 存储最近的对话历史
- 限制长度，自动移除最旧的对话
- 用于上下文理解和连续对话

**长期记忆**：
- 基于重要性筛选和存储关键信息
- 按重要性排序，保留最重要的记忆
- 支持重要性计算（基于长度、关键词等）

### 4.3 执行规划功能

**计划生成**：
- 使用LLM为复杂任务制定步骤化计划
- 每个计划包含：步骤号、动作类型、理由、工具名称

**计划执行**：
- 按顺序执行每个步骤
- 支持工具调用、直接回答、追问用户等动作类型
- 收集所有工具执行结果，用于最终总结

### 4.4 工具使用机制

**工具解析**：
- 分析用户输入，确定需要使用的工具
- 自动提取工具所需参数
- 评估置信度，确保准确性

**工具执行**：
- 动态调用注册的工具函数
- 捕获和处理执行异常
- 格式化和展示执行结果

## 5. 使用方法

### 5.1 启动程序

```bash
python main.py
```

### 5.2 基本交互

程序启动后进入交互模式，可以输入各类查询请求：

```
请输入您的请求: 计算9乘8和6+9的值
```

系统会生成执行计划并执行：
```
计划: [{"step": 1, "action": "使用工具", "reason": "需要计算9乘8的值，使用multiply工具", "tool_name": "multiply"}, {"step": 2, "action": "使用工具", "reason": "需要计算6加9的值，使用add工具", "tool_name": "add"}, {"step": 3, "action": "直接回答", "reason": "已经获取了两个运算的结果，可以总结并回答用户的问题"}]

执行步骤 1: 使用工具 - 需要计算9乘8的值，使用multiply工具
...
执行步骤 2: 使用工具 - 需要计算6加9的值，使用add工具
...
执行步骤 3: 直接回答 - 已经获取了两个运算的结果，可以总结并回答用户的问题
```

### 5.3 特殊命令

系统支持以下特殊命令：
- `status`：查看Agent当前状态（记忆数量、工具数量等）
- `memory`：查看问题记忆摘要
- `history`：查看工具执行历史记录
- `clear`：清除所有记忆
- `退出`：结束程序

## 6. 技术栈

- **编程语言**：Python 3.10+
- **LLM集成**：Ollama API（支持DeepSeek-R1-32B等模型）
- **核心库**：
  - langchain_ollama：与Ollama LLM交互
  - json、re：数据处理和正则表达式
  - datetime：时间处理

## 7. 扩展与定制

### 7.1 添加新工具

可以通过以下步骤添加新工具：
1. 在tool_add.py中定义工具函数
2. 使用`tool.register_tool()`注册工具

示例：
```python
def new_tool(param1, param2):
    # 工具实现逻辑
    return result

tool.register_tool("new_tool", "新工具的功能描述", new_tool)
```

### 7.2 调整LLM配置

在main.py中可以修改LLM的连接配置：
```python
llm = OllamaLLM(
    base_url="http://your-ollama-server:port",
    model="your-model-name",
    temperature=0.7
)
```

## 8. 总结

React增强型智能Agent项目实现了一个完整的智能代理系统，通过整合LLM、记忆管理、执行规划和工具使用等功能，提供了强大的任务处理能力。系统采用模块化设计，易于扩展和维护，能够适应各种复杂场景的需求。